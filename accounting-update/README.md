# تحديث نظام المحاسبة - إصلاح الإحصائيات والأرصدة

تاريخ التحديث: 2024-05-17

## المشكلة

1. **مشكلة عرض الإحصائيات**: يتم عرض إحصائيات فقط للحسابات الموجودة في الصفحة الحالية وليس لجميع الحسابات في النظام، مما يؤدي إلى عدم دقة الإحصائيات في البوكسات العلوية.

2. **مشكلة عرض الأرصدة**: يظهر "غير متوفر حالياً" بدلاً من الأرصدة الفعلية للصناديق النقدية.

## التحديثات التي تم إجراؤها

1. **تحديث إحصائيات الحسابات**:
   - تم تعديل طريقة حساب إحصائيات الحسابات بحيث تعرض العدد الإجمالي لجميع الحسابات وليس فقط الصفحة الحالية
   - استخدام استعلامات مباشرة لقاعدة البيانات بدلاً من العمل على مجموعة البيانات المرسلة للعرض

2. **إظهار الأرصدة الفعلية للصناديق النقدية**:
   - تم استبدال "غير متوفر حالياً" بالأرصدة الفعلية المحسوبة من قاعدة البيانات
   - تم حساب الأرصدة بناءً على الحركات المالية الفعلية في القيود المحاسبية
   - تم تحسين شريط التقدم (progress bar) ليعكس نسبة الرصيد مقارنة بأعلى رصيد

3. **تحسين عرض صناديق النقد**:
   - تم تعديل الكود ليعرض جميع الصناديق النقدية وليس فقط تلك الموجودة في الصفحة الحالية
   - ترتيب الصناديق واختيار أهم 8 منها للعرض

## الملفات التي تم تحديثها

- `resources/views/accounts/index_real.blade.php`: تحديث عرض الإحصائيات والأرصدة

## طريقة التثبيت

1. قم بنسخ ملف `resources/views/accounts/index_real.blade.php` إلى المسار المقابل له في التطبيق على الخادم.

2. تأكد من مسح جميع أنواع الذاكرة المؤقتة للتطبيق. نفّذ الأوامر التالية:
   ```
   php artisan cache:clear
   php artisan view:clear
   php artisan config:clear
   php artisan route:clear
   ```

3. إذا كان لديك نسخة محلية، قد تحتاج لإعادة تشغيل خادم التطوير:
   ```
   php artisan serve
   ```

## ملاحظات هامة

- هذا التحديث يتطلب وصولاً مباشراً إلى قاعدة البيانات لحساب الأرصدة الفعلية
- قد يكون هناك تأثير بسيط على أداء الصفحة بسبب الاستعلامات الإضافية لقاعدة البيانات
- إذا كان لديك عدد كبير من الحسابات، فقد تحتاج إلى تحسين الأداء عن طريق استخدام الذاكرة المؤقتة (caching) 